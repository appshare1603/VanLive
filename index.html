<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VanLive Dashboard</title>
    <!-- Tailwind CSS für das Design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel für die Live-Kompilierung im Browser -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #020617; }
        .horizon-line { transition: transform 0.3s ease-out; }
        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }
        .scan-line {
            animation: scan 4s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons als Komponente definieren
        const Icon = ({ name, className }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        // Visualisierung für den Neigungssensor
        const LevelIndicator = ({ pitch, roll }) => {
            return (
                <div className="relative w-24 h-24 bg-slate-800 rounded-full border-2 border-slate-700 flex items-center justify-center overflow-hidden mx-auto mb-4">
                    {/* Skala Kreise */}
                    <div className="absolute inset-0 border border-slate-700/50 rounded-full scale-75"></div>
                    <div className="absolute inset-0 border border-slate-700/50 rounded-full scale-50"></div>
                    
                    {/* Horizont Linie basierend auf Pitch und Roll */}
                    <div 
                        className="horizon-line absolute w-32 h-0.5 bg-purple-500 shadow-[0_0_10px_rgba(168,85,247,0.5)]"
                        style={{ 
                            transform: `rotate(${roll}deg) translateY(${pitch * 2}px)` 
                        }}
                    ></div>
                    
                    {/* Zentrum Markierung */}
                    <div className="absolute w-2 h-2 bg-white rounded-full z-10"></div>
                </div>
            );
        };

        const VanDashboard = () => {
            const [data, setData] = useState({
                tempIn: "--", tempOut: "--", humidity: "--",
                batteryBoard: "--", batteryStart: "--",
                waterLevel: 0, gasValue: 0, pitch: 0, roll: 0,
                weather: { condition: "Sonnig", temp: "--", forecast: "Lade Daten..." },
                lastUpdate: "Warte..."
            });
            const [loading, setLoading] = useState(false);

            const fetchData = async () => {
                setLoading(true);
                await new Promise(r => setTimeout(r, 800));
                const mockData = {
                    tempIn: (19 + Math.random() * 5).toFixed(1),
                    tempOut: (4 + Math.random() * 8).toFixed(1),
                    humidity: (35 + Math.random() * 20).toFixed(0),
                    batteryBoard: (12.6 + Math.random() * 0.6).toFixed(1),
                    batteryStart: (12.2 + Math.random() * 0.4).toFixed(1),
                    waterLevel: Math.floor(35 + Math.random() * 40),
                    gasValue: Math.floor(Math.random() * 450),
                    pitch: (Math.random() * 10 - 5).toFixed(1),
                    roll: (Math.random() * 10 - 5).toFixed(1),
                    weather: {
                        condition: Math.random() > 0.7 ? "Regen" : (Math.random() > 0.4 ? "Bewölkt" : "Sonnig"),
                        temp: (5 + Math.random() * 10).toFixed(0),
                        forecast: "Heiter bis wolkig, nachts frostig"
                    },
                    lastUpdate: new Date().toLocaleTimeString('de-DE')
                };
                setData(mockData);
                setLoading(false);
            };

            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 15000);
                return () => clearInterval(interval);
            }, []);

            const isGasAlarm = parseInt(data.gasValue) > 350;
            const isUnlevel = Math.abs(parseFloat(data.pitch)) > 1.5 || Math.abs(parseFloat(data.roll)) > 1.5;

            return (
                <div className="min-h-screen text-slate-100 p-4 md:p-8">
                    <header className="flex justify-between items-center max-w-7xl mx-auto mb-8">
                        <div className="text-left">
                            <h1 className="text-3xl font-extrabold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">
                                VanLive
                            </h1>
                            <p className="text-slate-500 text-xs font-bold uppercase tracking-widest mt-1">by DavisOnTheRoad</p>
                        </div>
                        <button onClick={fetchData} className="p-3 bg-slate-800 rounded-2xl border border-slate-700">
                            <Icon name="refresh-cw" className={`w-5 h-5 text-blue-400 ${loading ? 'animate-spin' : ''}`} />
                        </button>
                    </header>

                    <main className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-left">
                        
                        {/* Wetter Forecast Card */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800 lg:col-span-2">
                            <div className="flex justify-between mb-4">
                                <Icon name={data.weather.condition === "Regen" ? "cloud-rain" : (data.weather.condition === "Bewölkt" ? "cloud" : "sun")} className="text-yellow-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Wetter Vorhersage</span>
                            </div>
                            <div className="flex items-center gap-6">
                                <div>
                                    <p className="text-4xl font-bold">{data.weather.temp} °C</p>
                                    <p className="text-sm text-slate-400">{data.weather.condition}</p>
                                </div>
                                <div className="border-l border-slate-800 pl-6">
                                    <p className="text-xs text-slate-500 italic uppercase mb-1">Ausblick</p>
                                    <p className="text-lg font-medium text-slate-300">{data.weather.forecast}</p>
                                </div>
                            </div>
                        </div>

                        {/* Radio Integration (Antenne 1 Webplayer) */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800 flex flex-col">
                            <div className="flex justify-between mb-4">
                                <div className="flex items-center gap-2">
                                    <Icon name="radio" className="text-orange-400" />
                                    <span className="text-xs font-bold">Antenne 1</span>
                                </div>
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Entertainment</span>
                            </div>
                            <div className="relative flex-grow bg-slate-950 rounded-xl overflow-hidden border border-slate-800 h-48">
                                <iframe 
                                    src="https://www.antenne1.de/webradio/player" 
                                    className="w-full h-full border-none"
                                    title="Antenne 1 Radio"
                                    allow="autoplay; encrypted-media"
                                ></iframe>
                            </div>
                        </div>

                        {/* Außenkamera Simulation */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800 flex flex-col">
                            <div className="flex justify-between mb-4">
                                <Icon name="video" className="text-red-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Außenkamera</span>
                            </div>
                            <div className="relative flex-grow bg-black rounded-xl overflow-hidden aspect-video border border-slate-800">
                                {/* Kamerabild Simulation */}
                                <div className="absolute inset-0 flex items-center justify-center opacity-20">
                                    <Icon name="mountain" className="w-16 h-16 text-slate-400" />
                                </div>
                                {/* Scanline Effekt */}
                                <div className="scan-line absolute left-0 right-0 h-0.5 bg-red-500/30 shadow-[0_0_8px_rgba(239,68,68,0.5)]"></div>
                                {/* Live Indikator */}
                                <div className="absolute top-2 left-2 flex items-center gap-1">
                                    <div className="w-2 h-2 bg-red-600 rounded-full animate-pulse"></div>
                                    <span className="text-[8px] font-bold uppercase tracking-tighter">Live</span>
                                </div>
                                <div className="absolute bottom-2 right-2 text-[8px] font-mono text-slate-400">
                                    CAM_01_REAR
                                </div>
                            </div>
                        </div>

                        {/* Leveling Card mit Visualisierung */}
                        <div className={`bg-slate-900/50 p-6 rounded-[2rem] border ${isUnlevel ? 'border-purple-500 shadow-[0_0_15px_rgba(168,85,247,0.2)]' : 'border-slate-800'}`}>
                            <div className="flex justify-between mb-4">
                                <Icon name="compass" className="text-purple-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Ausrichtung</span>
                            </div>
                            
                            <LevelIndicator pitch={parseFloat(data.pitch)} roll={parseFloat(data.roll)} />
                            
                            <div className="flex justify-around text-center">
                                <div><p className="text-[10px] text-slate-500 uppercase font-bold">Pitch</p><p className="text-xl font-bold">{data.pitch}°</p></div>
                                <div><p className="text-[10px] text-slate-500 uppercase font-bold">Roll</p><p className="text-xl font-bold">{data.roll}°</p></div>
                            </div>
                        </div>

                        {/* Battery Board Card */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="battery" className="text-emerald-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Bordnetz</span>
                            </div>
                            <p className="text-4xl font-bold text-emerald-100">{data.batteryBoard} V</p>
                            <p className="text-xs text-slate-500 mt-2">LiFePO4 Versorger</p>
                        </div>

                        {/* Battery Starter Card */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="zap" className="text-blue-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Starter</span>
                            </div>
                            <p className="text-4xl font-bold text-blue-100">{data.batteryStart} V</p>
                            <p className="text-xs text-slate-500 mt-2">Starterbatterie</p>
                        </div>

                        {/* Gas Card */}
                        <div className={`bg-slate-900/50 p-6 rounded-[2rem] border ${isGasAlarm ? 'border-red-500 bg-red-900/10' : 'border-slate-800'}`}>
                            <div className="flex justify-between mb-4">
                                <Icon name="alert-triangle" className={isGasAlarm ? "text-red-500 animate-pulse" : "text-slate-500"} />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Sicherheit</span>
                            </div>
                            <p className="text-xs text-slate-500">Gassensor</p>
                            <p className={`text-4xl font-bold ${isGasAlarm ? 'text-red-500' : ''}`}>{data.gasValue} ppm</p>
                        </div>

                        {/* Temp Indoor */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="thermometer" className="text-orange-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Innen</span>
                            </div>
                            <p className="text-4xl font-bold">{data.tempIn} °C</p>
                        </div>

                        {/* Temp Outdoor */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="cloud" className="text-blue-300" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Außen</span>
                            </div>
                            <p className="text-4xl font-bold">{data.tempOut} °C</p>
                        </div>

                        {/* Water Level */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="waves" className="text-blue-500" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Frischwasser</span>
                            </div>
                            <p className="text-4xl font-bold">{data.waterLevel} %</p>
                            <div className="w-full bg-slate-800 h-1.5 rounded-full mt-4 overflow-hidden">
                                <div className="bg-blue-500 h-full transition-all duration-1000" style={{width: `${data.waterLevel}%`}}></div>
                            </div>
                        </div>
                    </main>

                    <footer className="max-w-7xl mx-auto mt-12 pt-8 border-t border-slate-900 flex justify-between items-center opacity-50">
                        <div className="flex items-center gap-2 text-xs">
                            <Icon name="clock" className="w-3 h-3" />
                            <span>Stand: {data.lastUpdate}</span>
                        </div>
                        <span className="text-[10px] font-bold tracking-widest uppercase text-emerald-500">System Live</span>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VanDashboard />);
    </script>
</body>
</html>
