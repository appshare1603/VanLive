<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VanLive Dashboard</title>
    <!-- Tailwind CSS für das Design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel für die Live-Kompilierung im Browser -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #020617; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons als Komponente definieren
        const Icon = ({ name, className }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const VanDashboard = () => {
            const [data, setData] = useState({
                tempIn: "--", tempOut: "--", humidity: "--",
                batteryBoard: "--", batteryStart: "--",
                waterLevel: 0, gasValue: 0, pitch: 0, roll: 0,
                weather: { condition: "Sonnig", temp: "--", forecast: "Lade Daten..." },
                lastUpdate: "Warte..."
            });
            const [loading, setLoading] = useState(false);

            const fetchData = async () => {
                setLoading(true);
                await new Promise(r => setTimeout(r, 800));
                const mockData = {
                    tempIn: (19 + Math.random() * 5).toFixed(1),
                    tempOut: (4 + Math.random() * 8).toFixed(1),
                    humidity: (35 + Math.random() * 20).toFixed(0),
                    batteryBoard: (12.6 + Math.random() * 0.6).toFixed(1),
                    batteryStart: (12.2 + Math.random() * 0.4).toFixed(1),
                    waterLevel: Math.floor(35 + Math.random() * 40),
                    gasValue: Math.floor(Math.random() * 450),
                    pitch: (Math.random() * 4 - 2).toFixed(1),
                    roll: (Math.random() * 6 - 3).toFixed(1),
                    weather: {
                        condition: Math.random() > 0.7 ? "Regen" : (Math.random() > 0.4 ? "Bewölkt" : "Sonnig"),
                        temp: (5 + Math.random() * 10).toFixed(0),
                        forecast: "Heiter bis wolkig, nachts frostig"
                    },
                    lastUpdate: new Date().toLocaleTimeString('de-DE')
                };
                setData(mockData);
                setLoading(false);
            };

            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 15000);
                return () => clearInterval(interval);
            }, []);

            const isGasAlarm = parseInt(data.gasValue) > 350;
            const isUnlevel = Math.abs(data.pitch) > 1.5 || Math.abs(data.roll) > 1.5;

            return (
                <div className="min-h-screen text-slate-100 p-4 md:p-8">
                    <header className="flex justify-between items-center max-w-7xl mx-auto mb-8">
                        <div className="text-left">
                            <h1 className="text-3xl font-extrabold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">
                                VanLive
                            </h1>
                            <p className="text-slate-500 text-xs font-bold uppercase tracking-widest mt-1">by DavisOnTheRoad</p>
                        </div>
                        <button onClick={fetchData} className="p-3 bg-slate-800 rounded-2xl border border-slate-700">
                            <Icon name="refresh-cw" className={`w-5 h-5 text-blue-400 ${loading ? 'animate-spin' : ''}`} />
                        </button>
                    </header>

                    <main className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-left">
                        
                        {/* Wetter Forecast Card */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800 lg:col-span-2">
                            <div className="flex justify-between mb-4">
                                <Icon name={data.weather.condition === "Regen" ? "cloud-rain" : (data.weather.condition === "Bewölkt" ? "cloud" : "sun")} className="text-yellow-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Wetter Vorhersage</span>
                            </div>
                            <div className="flex items-center gap-6">
                                <div>
                                    <p className="text-4xl font-bold">{data.weather.temp} °C</p>
                                    <p className="text-sm text-slate-400">{data.weather.condition}</p>
                                </div>
                                <div className="border-l border-slate-800 pl-6">
                                    <p className="text-xs text-slate-500 italic uppercase mb-1">Ausblick</p>
                                    <p className="text-lg font-medium text-slate-300">{data.weather.forecast}</p>
                                </div>
                            </div>
                        </div>

                        {/* Leveling Card */}
                        <div className={`bg-slate-900/50 p-6 rounded-[2rem] border ${isUnlevel ? 'border-purple-500' : 'border-slate-800'}`}>
                            <div className="flex justify-between mb-4">
                                <Icon name="compass" className="text-purple-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Ausrichtung</span>
                            </div>
                            <div className="flex gap-4">
                                <div><p className="text-xs text-slate-500">Pitch</p><p className="text-2xl font-bold">{data.pitch}°</p></div>
                                <div><p className="text-xs text-slate-500">Roll</p><p className="text-2xl font-bold">{data.roll}°</p></div>
                            </div>
                        </div>

                        {/* Battery Card */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="battery" className="text-emerald-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Batterie</span>
                            </div>
                            <p className="text-xs text-slate-500">Bordnetz</p>
                            <p className="text-4xl font-bold text-emerald-100">{data.batteryBoard} V</p>
                        </div>

                        {/* Gas Card */}
                        <div className={`bg-slate-900/50 p-6 rounded-[2rem] border ${isGasAlarm ? 'border-red-500 bg-red-900/10' : 'border-slate-800'}`}>
                            <div className="flex justify-between mb-4">
                                <Icon name="alert-triangle" className={isGasAlarm ? "text-red-500" : "text-slate-500"} />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Sicherheit</span>
                            </div>
                            <p className="text-xs text-slate-500">Gassensor</p>
                            <p className={`text-4xl font-bold ${isGasAlarm ? 'text-red-500' : ''}`}>{data.gasValue} ppm</p>
                        </div>

                        {/* Temp Indoor */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="thermometer" className="text-orange-400" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Innen</span>
                            </div>
                            <p className="text-4xl font-bold">{data.tempIn} °C</p>
                        </div>

                        {/* Temp Outdoor */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="cloud" className="text-blue-300" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Außen</span>
                            </div>
                            <p className="text-4xl font-bold">{data.tempOut} °C</p>
                        </div>

                        {/* Water Level */}
                        <div className="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                            <div className="flex justify-between mb-4">
                                <Icon name="waves" className="text-blue-500" />
                                <span className="text-[10px] text-slate-500 font-bold uppercase">Wasser</span>
                            </div>
                            <p className="text-4xl font-bold">{data.waterLevel} %</p>
                            <div className="w-full bg-slate-800 h-1.5 rounded-full mt-4 overflow-hidden">
                                <div className="bg-blue-500 h-full transition-all duration-1000" style={{width: `${data.waterLevel}%`}}></div>
                            </div>
                        </div>
                    </main>

                    <footer className="max-w-7xl mx-auto mt-12 pt-8 border-t border-slate-900 flex justify-between items-center opacity-50">
                        <div className="flex items-center gap-2 text-xs">
                            <Icon name="clock" className="w-3 h-3" />
                            <span>Zuletzt aktualisiert: {data.lastUpdate}</span>
                        </div>
                        <span className="text-[10px] font-bold tracking-widest uppercase">ESP32 Live Stream</span>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VanDashboard />);
    </script>
</body>
</html>
